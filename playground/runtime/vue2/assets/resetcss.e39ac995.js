var W=Object.defineProperty;var g=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var L=(n,e,t)=>e in n?W(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,y=(n,e)=>{for(var t in e||(e={}))$.call(e,t)&&L(n,t,e[t]);if(g)for(var t of g(e))k.call(e,t)&&L(n,t,e[t]);return n};const F=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}};F();var p={exports:{}},u=typeof Reflect=="object"?Reflect:null,E=u&&typeof u.apply=="function"?u.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)},l;u&&typeof u.ownKeys=="function"?l=u.ownKeys:Object.getOwnPropertySymbols?l=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:l=function(e){return Object.getOwnPropertyNames(e)};function D(n){console&&console.warn&&console.warn(n)}var _=Number.isNaN||function(e){return e!==e};function f(){f.init.call(this)}p.exports=f;p.exports.once=K;f.EventEmitter=f;f.prototype._events=void 0;f.prototype._eventsCount=0;f.prototype._maxListeners=void 0;var b=10;function m(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(n){if(typeof n!="number"||n<0||_(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");b=n}});f.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};f.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||_(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function x(n){return n._maxListeners===void 0?f.defaultMaxListeners:n._maxListeners}f.prototype.getMaxListeners=function(){return x(this)};f.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var i=e==="error",r=this._events;if(r!==void 0)i=i&&r.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var c=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw c.context=o,c}var a=r[e];if(a===void 0)return!1;if(typeof a=="function")E(a,this,t);else for(var d=a.length,R=A(a,d),s=0;s<d;++s)E(R[s],this,t);return!0};function C(n,e,t,s){var i,r,o;if(m(t),r=n._events,r===void 0?(r=n._events=Object.create(null),n._eventsCount=0):(r.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),r=n._events),o=r[e]),o===void 0)o=r[e]=t,++n._eventsCount;else if(typeof o=="function"?o=r[e]=s?[t,o]:[o,t]:s?o.unshift(t):o.push(t),i=x(n),i>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=n,c.type=e,c.count=o.length,D(c)}return n}f.prototype.addListener=function(e,t){return C(this,e,t,!1)};f.prototype.on=f.prototype.addListener;f.prototype.prependListener=function(e,t){return C(this,e,t,!0)};function B(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function N(n,e,t){var s={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},i=B.bind(s);return i.listener=t,s.wrapFn=i,i}f.prototype.once=function(e,t){return m(t),this.on(e,N(this,e,t)),this};f.prototype.prependOnceListener=function(e,t){return m(t),this.prependListener(e,N(this,e,t)),this};f.prototype.removeListener=function(e,t){var s,i,r,o,c;if(m(t),i=this._events,i===void 0)return this;if(s=i[e],s===void 0)return this;if(s===t||s.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,s.listener||t));else if(typeof s!="function"){for(r=-1,o=s.length-1;o>=0;o--)if(s[o]===t||s[o].listener===t){c=s[o].listener,r=o;break}if(r<0)return this;r===0?s.shift():H(s,r),s.length===1&&(i[e]=s[0]),i.removeListener!==void 0&&this.emit("removeListener",e,c||t)}return this};f.prototype.off=f.prototype.removeListener;f.prototype.removeAllListeners=function(e){var t,s,i;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var r=Object.keys(s),o;for(i=0;i<r.length;++i)o=r[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=s[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function M(n,e,t){var s=n._events;if(s===void 0)return[];var i=s[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?z(i):A(i,i.length)}f.prototype.listeners=function(e){return M(this,e,!0)};f.prototype.rawListeners=function(e){return M(this,e,!1)};f.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):I.call(n,e)};f.prototype.listenerCount=I;function I(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}f.prototype.eventNames=function(){return this._eventsCount>0?l(this._events):[]};function A(n,e){for(var t=new Array(e),s=0;s<e;++s)t[s]=n[s];return t}function H(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function z(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function K(n,e){return new Promise(function(t,s){function i(o){n.removeListener(e,r),s(o)}function r(){typeof n.removeListener=="function"&&n.removeListener("error",i),t([].slice.call(arguments))}j(n,e,r,{once:!0}),e!=="error"&&V(n,i,{once:!0})})}function V(n,e,t){typeof n.on=="function"&&j(n,"error",e,t)}function j(n,e,t,s){if(typeof n.on=="function")s.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function i(r){s.once&&n.removeEventListener(e,i),t(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}class q{constructor(e=globalThis.navigator.userAgent,t={}){this.isIos=!1,this.isIphone=!1,this.isIpad=!1,this.isAndroid=!1,this.isAnroidPad=!1,this.isMac=!1,this.isWin=!1,this.isMqq=!1,this.isWechat=!1,this.isWeb=!1,this.isIphone=e.indexOf("iPhone")>=0,this.isIpad=/(iPad).*OS\s([\d_]+)/.test(e),this.isIos=this.isIphone||this.isIpad,this.isAndroid=e.indexOf("Android")>=0,this.isAnroidPad=this.isAndroid&&e.indexOf("Mobile")<0,this.isMac=e.indexOf("Macintosh")>=0,this.isWin=e.indexOf("Windows")>=0,this.isMqq=/QQ\/([\d.]+)/.test(e),this.isWechat=e.indexOf("MicroMessenger")>=0&&e.indexOf("wxwork")<0,this.isWeb=!this.isIos&&!this.isAndroid&&!/(WebOS|BlackBerry)/.test(e),Object.entries(t).forEach(([s,i])=>{this[s]=i})}}const v="magic:common:events:",P="magic:common:actions:",h={SHOW:"show",HIDE:"hide",SCROLL_TO_VIEW:"scrollIntoView",SCROLL_TO_TOP:"scrollToTop"},U=[{label:"\u70B9\u51FB",value:`${v}click`}],S=(n,e)=>{const t=`${n}:${e}`;return n.startsWith(v)?t:`${v}${t}`},Q=n=>n.startsWith(P),T=(n,e)=>{var s;if(!n)return!1;if(!n.id)return T(n.parentElement,e);const t=(s=e.page)==null?void 0:s.getNode(n.id);return t||!1},w=(n,e,t)=>{const s=T(t.target,n);if(s){const{instance:i,data:r}=s;n.emit(S(e,r.id),i)}},X=n=>{window.document.body.addEventListener("click",e=>{w(n,"click",e)}),window.document.body.addEventListener("click",e=>{w(n,"click:capture",e)},!0)},G=(n,e)=>{const{instance:t}=e;switch(n.replace(P,"")){case h.SHOW:t.show();break;case h.HIDE:t.hide();break;case h.SCROLL_TO_VIEW:t.$el.scrollIntoView({behavior:"smooth"});break;case h.SCROLL_TO_TOP:window.scrollTo({top:0,behavior:"smooth"});break}};class O extends p.exports.EventEmitter{constructor(e){super();const{events:t}=e;this.data=e,this.events=t,this.listenLifeSafe(),this.once("destroy",()=>{this.instance=null,typeof this.data.destroy=="function"&&this.data.destroy(this),this.listenLifeSafe()})}listenLifeSafe(){this.once("created",e=>{this.instance=e,typeof this.data.created=="function"&&this.data.created(this)}),this.once("mounted",e=>{this.instance=e,typeof this.data.mounted=="function"&&this.data.mounted(this)})}}class J extends O{constructor(e){super(e.config),this.nodes=new Map,this.setNode(e.config.id,this),this.initNode(e.config)}initNode(e){var t;this.setNode(e.id,new O(e)),(t=e.items)==null||t.forEach(s=>{this.initNode(s)})}getNode(e){return this.nodes.get(e)}setNode(e,t){this.nodes.set(e,t)}deleteNode(e){this.nodes.delete(e)}}const Y=n=>{if(typeof n!="string")return n;const e={};return n.split(";").forEach(t=>{if(!t)return;const s=t.split(":");let i=s.shift(),r=s.join(":");!i||(i=i.replace(/^\s*/,"").replace(/\s*$/,""),r=r.replace(/^\s*/,"").replace(/\s*$/,""),i=i.split("-").map((o,c)=>c>0?`${o[0].toUpperCase()}${o.substr(1)}`:o).join(""),e[i]=r)}),e},Z=n=>n&&!/^url/.test(n)&&!/^linear-gradient/.test(n)?`url(${n})`:n;class te extends p.exports.EventEmitter{constructor(e){if(super(),this.pages=new Map,this.platform="mobile",this.jsEngine="browser",this.components=new Map,this.env=new q(e.ua),e.platform&&(this.platform=e.platform),e.jsEngine&&(this.jsEngine=e.jsEngine),this.platform==="mobile"||this.platform==="editor"){const t=()=>{let{width:s}=document.documentElement.getBoundingClientRect();s=Math.min(800,s);const i=s/3.75;document.documentElement.style.fontSize=`${i}px`};t(),document.body.style.fontSize="14px",globalThis.addEventListener("resize",t)}e.transformStyle&&(this.transformStyle=e.transformStyle),e.config&&this.setConfig(e.config,e.curPage),X(this)}transformStyle(e){if(!e)return{};let t={};const s={};typeof e=="string"?t=Y(e):t=y({},e);const i=["zIndex","opacity","fontWeight"];return Object.entries(t).forEach(([r,o])=>{r==="backgroundImage"?o&&(s[r]=Z(o)):!i.includes(r)&&o&&/^[-]?[0-9]*[.]?[0-9]*$/.test(o)?s[r]=`${o/100}rem`:s[r]=o}),s}setConfig(e,t){var s,i,r;this.pages=new Map,(s=e.items)==null||s.forEach(o=>{this.pages.set(o.id,new J({config:o}))}),this.setPage(t||((r=(i=this.page)==null?void 0:i.data)==null?void 0:r.id))}setPage(e){let t;e&&(t=this.pages.get(e)),t||(t=this.pages.get(this.pages.keys().next().value)),this.page=t,this.platform!=="magic"&&this.bindEvents()}registerComponent(e,t){this.components.set(e,t)}unregisterComponent(e){this.components.delete(e)}resolveComponent(e){return this.components.get(e)}bindEvents(){var e;if(!!this.page){this.removeAllListeners();for(const[,t]of this.page.nodes)(e=t.events)==null||e.forEach(s=>{let{name:i}=s;U.findIndex(r=>r.value===i)>-1&&(i=S(i,`${t.data.id}`)),this.on(i,(r,...o)=>{var d;if(!this.page)throw new Error("\u5F53\u524D\u6CA1\u6709\u9875\u9762");const c=this.page.getNode(s.to);if(!c)throw`ID\u4E3A${s.to}\u7684\u7EC4\u4EF6\u4E0D\u5B58\u5728`;const{method:a}=s;if(Q(a))return G(a,c);typeof((d=c.instance)==null?void 0:d[a])=="function"&&c.instance[a](r,...o)})})}}destroy(){this.removeAllListeners(),this.pages.clear()}}export{te as A};
